We have designed two free energy calculation protocols with the demands of clinical
decision support and drug design applications in mind: ESMACS (enhanced
sampling of molecular dynamics with approximation of continuum
solvent)~\cite{Wan2017brd4} and TIES (thermodynamic integration with enhanced
sampling)~\cite{Bhati2017}. 
The former protocol is based on variants of the molecular mechanics Poisson-Boltzmann 
surface area (MMPBSA) end-point method, the latter on the `alchemical' thermodynamic 
integration (TI) approach. 
In both cases, ensembles of MD simulations are employed to perform averaging and
to obtain tight control of error bounds in our estimates. 
In addition, the ability to run replica simulations concurrently means that, as long as
sufficient compute resources are available, turn around times can be significantly 
reduced compared to the generation of single long trajectories.
Due to their shared philosophical underpinning both protocols share similar middleware 
requirements.

The current implementation of both TIES and ESMACS uses the the NAMD package~\cite{Phillips2005}
to conduct the simulations.
Conceptually, each replica simulation consists of three stages: minimization, equilibration 
and production MD.
In practice the equilibration phase is broken into multiple steps to ensure that the size of the 
simulation box does not alter too much over the simulation.
During these steps positional constraints are gradually released from the structure and the 
system is heated to a physiologically realistic temperature.
Whilst both protocols share a common workflow for individual replicas, the make up of the 
ensemble is different.
All ESMACS replicas sample using the same system description, in TIES sub-ensembles are executed 
at diffent points along a transformation parameter, $\lambda$.
As $\lambda$ increases from zero to one the system description transforms from containing an 
initial drug to a target via a series of hybrid states.
Typically, an ESMACS ensemble will contain 25 replicas and a TIES ensemble 65 replicas evenly 
distributed between 13 $\lambda$ values.
In order to obtain a meaningful TIES result it is necessary to not only simulate the drug pair 
in the protein but also in an aqueous environemnt, adding a further 65 replicas albeit it using a
smaller system at lower computational cost.
In the case of ESMACS, upon completion of the MD simulation, free energy computation 
(via MMPBSA and potentially normal mode analysis) is performed using 
AmberTools~\cite{amber14, Case2005, MillerIII2012}.
In both cases short serial jobs are then required to provide summary statistics.

Both protocols can are highly customizable, for example the number of simulation replicas in the 
ensemble and the lengths of their runs can be varied.
More generally though, there may be cases where it is important to increase the sampling of phase 
space either through expanding the ensemble or by considering multiple initial configurations.
In addition, the ESMACS protocol can also be extended to account for adaptation energies involved 
in altering the conformation of the protein or ligand during binding through the use of separate 
component simulations.

%High level description of MD step here%

%Describe generic TIES & ESMACS workflows%