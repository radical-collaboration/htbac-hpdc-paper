Ensemble-based binding affinity protocols have  considerable predictive
potential in computational drug campaigns. As drug screening can cover
millions of compounds and hundreds of millions of core-hours, it is important
for binding affinity calculations to optimize the accuracy and precision of
results. However, the optimal protocol configuration for a given system is
difficult to determine {\it a priori}, thus requiring runtime adaptations to
workflow executions. We introduce HTBAC to enable scalable and adaptive
binding affinity energy calculations on HPC.

Specifically, this paper makes the following contributions: (1) shows how
adaptive execution of ensemble-based free energy protocol (TIES) improve
binding affinity accuracy given a fixed amount of computing resources; (2)
characterizes HTBAC, the software system we developed to address the
aforementioned requirements; and (3) shows the capability to execute adaptive
applications at scale, validating their scientific results.

We characterize the performance of HTBAC on NCSA Blue Waters. We show
near-ideal weak and strong scaling behavior for ESMACS and TIES, individually
and together, reaching scales of 21,120 cores. Furthermore, we validate
binding free energies computed using HTBAC with both experimental and
previously published computational results.

We compare resource consumption and free energy accuracy in our adaptive and
non-adaptive TIES results. Using the adaptive quadrature algorithm, we show
improvements in $\Delta \Delta$G on average by 77\% over the 5 physical
systems tested. By reducing the $\lambda$ windows on average by 32\%, we
reduce execution time by the same amount. The adaptive termination
implementation of the TIES protocol saves compute resources and reduces time
to solution on average by 16\%. To the best of our knowledge, adaptive TIES
protocols have not been benchmarked against non-adaptive implementations
before.

% ---------------------------------------------------------------------------
\subsubsection*{Software and Data}

{\footnotesize All experimental data can be found at
\url{https://github.com/radical-experiments/htbac-escience-18}. HTBAC (MIT
license) can be found at: \url{https://github.com/radical-cybertools/htbac}}

% ---------------------------------------------------------------------------
\subsubsection*{Acknowledgements}

{\footnotesize JD acknowledges Dept. of Education Award P200A150217 for her
fellowship. PVC acknowledges the support of the EU H2020 CompBioMed (675451),
EUDAT2020 (654065) and ComPat (671564) projects. Access to Blue Waters was
made possible by NSF 1713749. The software capabilities were supported by
RADICAL-Cybertools (NSF 1440677). We thank Vivek Balasubramanian and Andre
Merzky for support with RADICAL-Cybertools.}
